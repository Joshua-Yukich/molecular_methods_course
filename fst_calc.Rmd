---
title: "R Fst Calculation: basic bio informatics"
output: html_document
date: "2025-02-20"
author: "J. Yukich"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup}
###############################
#
#
#  Some basic BioInformatic Analysis
#    Fst/Gst calculation.
#
#       J. Yukich Feb 20th 2025
#
#
################################
```

# **What is Fst?**

Fst (Fixation Index) is a measure of genetic differentiation between
populations. It quantifies how genetic variation is partitioned among
populations relative to the total genetic variation. It ranges from **0
to 1**, where:

-   **Fst = 0** → No genetic differentiation (populations share the same
    alleles at the same frequencies).

-   **Fst = 1** → Complete genetic separation (populations have entirely
    different alleles).

    ## **How to Calculate Fst?**

    Fst is calculated using allele frequencies across populations. The
    basic formula is:

    $$
      F_{ST} = \frac{H_T - H_S}{H_T}
      $$

Where:

-   **Ht (Total heterozygosity)**: Expected heterozygosity in the entire
    population (pooled across subpopulations).

-   **Hs (Subpopulation heterozygosity)**: Average expected
    heterozygosity within each subpopulation.

### **Step-by-Step Calculation of Fst**

#### **Step 1: Calculate Allele Frequencies**

For a biallelic locus (two alleles, e.g., A and a), suppose we have two
populations:

| Population | $p_A$ | $p_a$ |
|------------|-------|-------|
| Pop 1      | 0.6   | 0.4   |
| Pop 2      | 0.8   | 0.2   |

#### **Step 2: Compute Heterozygosities** The expected heterozygosity for
each population is:

$$
    H_s = 2 p q
    $$

For Pop 1: $$
    H_{s1} = 2 (0.6)(0.4) = 0.48
    $$

For Pop 2: $$
    H_{s2} = 2 (0.8)(0.2) = 0.32
    $$

The average heterozygosity across subpopulations:

$$
    H_S = \frac{H_{s1} + H_{s2}}{2} = \frac{0.48 + 0.32}{2} = 0.40
    $$

#### **Step 3: Calculate Total Heterozygosity**

The overall allele frequencies across populations:

$$
    \bar{p} = \frac{p_1 + p_2}{2} = \frac{0.6 + 0.8}{2} = 0.7
    $$ $$
  \bar{q} = 1 - \bar{p} = 0.3
  $$

Total heterozygosity:

$$
    H_T = 2 \bar{p} \bar{q} = 2(0.7)(0.3) = 0.42
    $$

#### **Step 4: Compute Fst**

$$
  F_{ST} = \frac{H_T - H_S}{H_T} = \frac{0.42 - 0.40}{0.42} = \frac{0.02}{0.42} \approx 0.048
  $$

------------------------------------------------------------------------

#### **Interpretation** - **Fst ≈ 0.048** means there is very little genetic differentiation between the two populations.

-   Generally:

-   **Fst \< 0.05** → Low differentiation

-   **0.05 - 0.15** → Moderate differentiation

-   **0.15 - 0.25** → High differentiation

-   **Fst \> 0.25** → Very high differentiation

#### **Real Data**

We're going to take some data that has been derived from sequncing data, which has already been aligned and variant called. These data are often stored in .vcf format, or compressed into a .vcf.gz 'tarball' when they are large.


```{r, eval=FALSE}
# load required packages -----
install.packages("adegenet")
install.packages("vcfR")
install.packages("pinfsc50")
install.packages("ape")
```

Once its installed, load the library for use.

```{r, warning=FALSE}
# load required packages -----
library(adegenet)
library(vcfR)
library(ape)
```


Then we can process the files. first we' point to the file locations. 


```{r}
pkg <- "pinfsc50"
vcf_file <- system.file("extdata", "pinf_sc50.vcf.gz", package = pkg)
dna_file <- system.file("extdata", "pinf_sc50.fasta", package = pkg)
gff_file <- system.file("extdata", "pinf_sc50.gff", package = pkg)

vcf <- read.vcfR(vcf_file)
dna <- read.dna(dna_file, format="fasta")

```


Next steps is to give a population assignment to each "sample" since the default vcfR format doesn't contian this. 

The data are derived from this study... 

Yoshida K, Schuenemann VJ, Cano LM, Pais M, Mishra B, Sharma R, Lanz C, Martin FN, Kamoun S, Krause J, Thines M, Weigel D, Burbano HA. The rise and fall of the *Phytophthora infestans* lineage that triggered the Irish potato famine. Elife. 2013 May 28;2:e00731. doi: 10.7554/eLife.00731. Erratum in: Elife. 2013;2:e01108. PMID: 23741619; PMCID: PMC3667578.

The basic dat ais that these are sequenced data for *P. infestans*, the filamentous microrganisim responsible for the "potato famine" which led massive disolocations in Europe and N. America in the mid 18th century. 

The 240 Mb T30-4 reference genome of *P. infestans* is large, with three quarters of the genome consisting of repetitive DNA.

Lets look at the DNA content, 

```{r}
print(head(dna))
head(read.delim(dna_file))
```


 and now the VCF directly.
```{r}
head(vcf)
```

Assign a population vector to show which population each sample belongs to. 


```{r}
pop <- as.factor(c("us", "eu", "us", "af", "eu", "us", "mx", "eu", "eu", "sa", "mx", "sa", "us", "sa", "Pmir", "us", "eu", "eu"))
```

Calculate and look at the Pop genetic stats.


```{r}

myDiff <- genetic_diff(vcf, pops = pop, method = 'nei')
knitr::kable(myDiff[10:20,c(1:2,16:19)])

```
